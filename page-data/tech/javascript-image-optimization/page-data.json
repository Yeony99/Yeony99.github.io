{"componentChunkName":"component---src-templates-blog-post-js","path":"/tech/javascript-image-optimization","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"frontmatter":{"category":"tech","slug":"/tech/javascript-image-optimization","tags":["JS"],"date":"2023-03-10","img":null,"title":"대량의 이미지 로딩 최적화하기 (Image Preload)"},"excerpt":"배경 회사에서 프로젝트 중, 이미지를 빠르게 넘겨 동영상처럼 보이게끔 하는 처리가 필요했다. 이미지는 API를 통해 여러 정보와 함께 json에 담겨 object[] 형태로 받고, 객체 key 'fileUrl'로 img…","html":"<h2 id=\"배경\" style=\"position:relative;\">배경<a href=\"#%EB%B0%B0%EA%B2%BD\" aria-label=\"배경 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>회사에서 프로젝트 중, 이미지를 빠르게 넘겨 동영상처럼 보이게끔 하는 처리가 필요했다.</p>\n<p>이미지는 API를 통해 여러 정보와 함께 json에 담겨 object[] 형태로 받고, 객체 key 'fileUrl'로 img 하나를 요청하는 방식이다.\r\n나는 처음 이 기획을 url을 <strong>바꿔치기</strong> 하는 방식으로 처리를 했었다.</p>\n<p>selected를 images의 index로 설정한 후 <code class=\"language-text\">setInterval</code>로 700ms에 한 번씩 selected의 index를 하나씩 늘리며 이미지를 하나씩 요청했다.</p>\n<deckgo-highlight-code language=\"jsx\" terminal=\"carbon\" theme=\"blackboard\"  >\n          <code slot=\"code\">// vue\r\n&lt;div :style=&quot;`background-image: url(${URL}${images[selected]})`&quot;&gt;\r\n\r\n&lt;/div&gt;</code>\n        </deckgo-highlight-code>\n<deckgo-highlight-code language=\"javascript\" terminal=\"carbon\" theme=\"blackboard\"  >\n          <code slot=\"code\">let isPlay = true;\r\nlet selected = 0;\r\n\r\n//...\r\n\r\nconst interval = setInterval(() =&gt; {\r\n  if(isPlay) {\r\n    selected++\r\n  } else {\r\n    clearInterval(interval)\r\n    isPlay = false;\r\n  }\r\n})</code>\n        </deckgo-highlight-code>\n<h3 id=\"문제점\" style=\"position:relative;\">문제점<a href=\"#%EB%AC%B8%EC%A0%9C%EC%A0%90\" aria-label=\"문제점 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>이 방식에는 큰 문제점이 있었다. 700ms의 속도로 하나당 약 1MB 크기의 이미지를 n백개 가량 요청하며 바꿔치기하다보니, 이미지를 받아오는 속도가 조금이라도 느려지면 화면이 깜빡거리거나 아예 이미지가 보이지 않고 넘어가는 경우가 발생했다.</p>\n<h3 id=\"해결법-찾기\" style=\"position:relative;\">해결법 찾기<a href=\"#%ED%95%B4%EA%B2%B0%EB%B2%95-%EC%B0%BE%EA%B8%B0\" aria-label=\"해결법 찾기 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>해결할 수 있는 방법을 찾아봤다. 대략 3가지 정도로 보였다.</p>\n<ol>\n<li>이미지를 등록할 때 썸네일 이미지도 저장해 적은 용량의 img를 로딩한다.</li>\n<li>이미지 캐싱</li>\n<li>img preload를 한다.</li>\n</ol>\n<p>캐싱은 한다쳐도 처음 로딩할 때는 어김없이 깜빡임 현상이 있을 것이고, 적합하지 않다고 판단했다.</p>\n<p>따라서 3번을 우선 적용한 후, 빠르게 돌려야 하는 img 개수가 더 늘어나면 썸네일 이미지 처리를 하는 것으로 결정했다.</p>\n<h2 id=\"image-preload\" style=\"position:relative;\">Image Preload<a href=\"#image-preload\" aria-label=\"image preload permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>이미지 Preload하는 방법은 간단하고, 대부분의 최신 브라우저에서 작동한다.</p>\n<deckgo-highlight-code language=\"javascript\" terminal=\"carbon\" theme=\"blackboard\"  >\n          <code slot=\"code\">// preload할 img 배열\r\nlet images = [];\r\n\r\nconst resultArr = // API 호출, return object[]\r\n//...\r\n\r\nfunction preload() {\r\n  for(let i = 0; i &lt; resultArr.length; i++) {\r\n    images[i] = new Image();\r\n    images[i].src = resultArr[i].fileUrl;\r\n  }\r\n}</code>\n        </deckgo-highlight-code>\n<p>API 호출해 받은 <code class=\"language-text\">resultArr</code> 배열만큼 for반복 돌리며, <code class=\"language-text\">new Image()</code>를 생성해 <code class=\"language-text\">images</code> 배열에 담았다.</p>\n<p>개발자 도구의 Network 탭에 들어가 이미지들이 제대로 로드됐는지 확인한다.</p>\n<p><img src=\"https://user-images.githubusercontent.com/76241233/224227023-f05150ae-24eb-456c-9efa-2c07d48f7453.png\" alt=\"개발자도구 Network 탭\"></p>\n<h2 id=\"참고하면-좋은-사이트\" style=\"position:relative;\">참고하면 좋은 사이트<a href=\"#%EC%B0%B8%EA%B3%A0%ED%95%98%EB%A9%B4-%EC%A2%8B%EC%9D%80-%EC%82%AC%EC%9D%B4%ED%8A%B8\" aria-label=\"참고하면 좋은 사이트 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p><a href=\"https://www.weather.go.kr/w/image/synthesis.do\">기상청</a>이 참고하기 좋은 사이트다.</p>\n<p>위 사이트에서 재생 버튼을 누르면 개발자 도구 Network 탭에 아래와 같이 이미지가 한번에 preload 되는 것을 확인할 수 있다.</p>\n<p><img src=\"https://user-images.githubusercontent.com/76241233/224228503-7d8aaf2e-7735-4461-8b15-3284ac995e13.gif\" alt=\"기상청 참고\"></p>","internal":{"content":"\r\n## 배경\r\n\r\n회사에서 프로젝트 중, 이미지를 빠르게 넘겨 동영상처럼 보이게끔 하는 처리가 필요했다. \r\n\r\n이미지는 API를 통해 여러 정보와 함께 json에 담겨 object[] 형태로 받고, 객체 key 'fileUrl'로 img 하나를 요청하는 방식이다. \r\n나는 처음 이 기획을 url을 **바꿔치기** 하는 방식으로 처리를 했었다.\r\n\r\nselected를 images의 index로 설정한 후 `setInterval`로 700ms에 한 번씩 selected의 index를 하나씩 늘리며 이미지를 하나씩 요청했다.\r\n\r\n```jsx\r\n// vue\r\n<div :style=\"`background-image: url(${URL}${images[selected]})`\">\r\n\r\n</div>\r\n```\r\n\r\n```javascript\r\nlet isPlay = true;\r\nlet selected = 0;\r\n\r\n//...\r\n\r\nconst interval = setInterval(() => {\r\n  if(isPlay) {\r\n    selected++\r\n  } else {\r\n    clearInterval(interval)\r\n    isPlay = false;\r\n  }\r\n})\r\n```\r\n\r\n### 문제점\r\n\r\n이 방식에는 큰 문제점이 있었다. 700ms의 속도로 하나당 약 1MB 크기의 이미지를 n백개 가량 요청하며 바꿔치기하다보니, 이미지를 받아오는 속도가 조금이라도 느려지면 화면이 깜빡거리거나 아예 이미지가 보이지 않고 넘어가는 경우가 발생했다. \r\n\r\n### 해결법 찾기\r\n\r\n해결할 수 있는 방법을 찾아봤다. 대략 3가지 정도로 보였다.\r\n\r\n1. 이미지를 등록할 때 썸네일 이미지도 저장해 적은 용량의 img를 로딩한다.\r\n2. 이미지 캐싱\r\n3. img preload를 한다.\r\n\r\n캐싱은 한다쳐도 처음 로딩할 때는 어김없이 깜빡임 현상이 있을 것이고, 적합하지 않다고 판단했다.\r\n\r\n따라서 3번을 우선 적용한 후, 빠르게 돌려야 하는 img 개수가 더 늘어나면 썸네일 이미지 처리를 하는 것으로 결정했다.\r\n\r\n\r\n## Image Preload\r\n\r\n이미지 Preload하는 방법은 간단하고, 대부분의 최신 브라우저에서 작동한다. \r\n\r\n```javascript\r\n// preload할 img 배열\r\nlet images = [];\r\n\r\nconst resultArr = // API 호출, return object[]\r\n//...\r\n\r\nfunction preload() {\r\n  for(let i = 0; i < resultArr.length; i++) {\r\n    images[i] = new Image();\r\n    images[i].src = resultArr[i].fileUrl;\r\n  }\r\n}\r\n```\r\n\r\nAPI 호출해 받은 `resultArr` 배열만큼 for반복 돌리며, `new Image()`를 생성해 `images` 배열에 담았다. \r\n\r\n개발자 도구의 Network 탭에 들어가 이미지들이 제대로 로드됐는지 확인한다.\r\n\r\n![개발자도구 Network 탭](https://user-images.githubusercontent.com/76241233/224227023-f05150ae-24eb-456c-9efa-2c07d48f7453.png)\r\n\r\n## 참고하면 좋은 사이트\r\n\r\n[기상청](https://www.weather.go.kr/w/image/synthesis.do)이 참고하기 좋은 사이트다.\r\n\r\n위 사이트에서 재생 버튼을 누르면 개발자 도구 Network 탭에 아래와 같이 이미지가 한번에 preload 되는 것을 확인할 수 있다.\r\n\r\n![기상청 참고](https://user-images.githubusercontent.com/76241233/224228503-7d8aaf2e-7735-4461-8b15-3284ac995e13.gif)\r\n"},"tableOfContents":"<ul>\n<li>\n<p><a href=\"#%EB%B0%B0%EA%B2%BD\">배경</a></p>\n<ul>\n<li><a href=\"#%EB%AC%B8%EC%A0%9C%EC%A0%90\">문제점</a></li>\n<li><a href=\"#%ED%95%B4%EA%B2%B0%EB%B2%95-%EC%B0%BE%EA%B8%B0\">해결법 찾기</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#image-preload\">Image Preload</a></p>\n</li>\n<li>\n<p><a href=\"#%EC%B0%B8%EA%B3%A0%ED%95%98%EB%A9%B4-%EC%A2%8B%EC%9D%80-%EC%82%AC%EC%9D%B4%ED%8A%B8\">참고하면 좋은 사이트</a></p>\n</li>\n</ul>"}}]}},"pageContext":{"slug":"/tech/javascript-image-optimization"}},"staticQueryHashes":["2665612806"]}